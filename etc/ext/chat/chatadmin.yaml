- name: scriptContent
  type: STRING
  value: |
    hasChannel = { n ->
      if (!n.startsWith('#')) {
        throw failure("That is not a valid channel name")
      }
      return hasAttr(extensionId, n)
    }
    getChannel = { n ->
      if (!n.startsWith('#')) {
        throw failure("That is not a valid channel name")
      }
      return getAttr(extensionId, n, "Channel $n not found")
    }
    subcommand = arg0
    switch (subcommand.toUpperCase()) {
      case "CREATE":
        if (hasChannel(arg1)) {
          throw failure("Channel ${arg1} already exists");
        }
        membersAttr = newAttr('members', '')
        channelAttrList = [ membersAttr ]
        setAttr(extensionId, arg1, channelAttrList)
        sendMessageToCaller("Created channel ${arg1}")
        break;
      case "DELETE":
        if (!hasChannel(arg1)) {
          throw failure("Channel ${arg1} does not exist");
        }
        removeAttr(extensionId, arg1);
        sendMessageToCaller("Deleted channel ${arg1}")
        break;
      default:
        throw failure("Unsupported command $subcommand")
    }
    return null
- name: scriptHelp
  type: ATTRLIST
  value: |
    - name: $CHATADMIN
      type: ATTRLIST
      value: |
        - name: syntax
          value: $CHATADMIN <subcommand> [<arguments>]
        - name: summary
          value: Administers the chat system
        - name: description
          value: "Available subcommands: create, delete"
    - name: $CHATADMIN_CREATE
      type: ATTRLIST
      value: |
        - name: syntax
          value: $CHATADMIN CREATE <channel>
        - name: summary
          value: Creates a new chat channel
        - name: description
          value: The new channel starts out with no members.
    - name: $CHATADMIN_DELETE
      type: ATTRLIST
      value: |
        - name: syntax
          value: $CHATADMIN DELETE <channel>
        - name: summary
          value: Deletes a new chat channel
        - name: description
          value: The membership of the channel is lost on deletion.
